<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Purple AI Interviewer</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="card">
    <img src="assets/logo.png" class="logo" alt="Team Purple Logo" />

    <div id="formSection">
      <h2>Candidate Registration</h2>
      <input type="text" id="name" placeholder="Your Full Name" required />
      <input type="email" id="email" placeholder="Email ID" required />
      <input type="tel" id="phone" placeholder="Phone Number" required />
      <input type="file" id="resume" accept=".pdf,.doc,.docx" />
      <input type="text" id="token" placeholder="Invitation Token" required />
      <select id="slot">
        <option value="">-- Select Interview Slot --</option>
        <option value="now">Continue Now</option>
        <option value="10AM">10:00 AM</option>
        <option value="2PM">2:00 PM</option>
        <option value="5PM">5:00 PM</option>
      </select>
      <button onclick="startInterview()">Start Interview</button>
    </div>

    <div id="instructions" style="display:none;">
      <h3>Interview Instructions</h3>
      <ul>
        <li>✅ Use a laptop/desktop with webcam and mic.</li>
        <li>✅ Quiet, well-lit environment required.</li>
        <li>🚫 No phones, earphones, or communication apps.</li>
        <li>🚫 No one else should be present.</li>
        <li>⚠️ Any cheating/misuse will result in disqualification.</li>
        <li>🎙 Ensure mic works, and stay connected to the internet.</li>
        <li>📧 Finish the interview within your scheduled time.</li>
      </ul>
      <p>Warm regards,<br>Team Purple<br>Recruitment Team</p>
      <button onclick="beginCountdown()">I'm Ready</button>
    </div>

    <div id="countdown" style="display:none;">
      <h2>Interview begins in <span id="cdTimer">3</span>...</h2>
    </div>
  </div>

  <script src="tokens.json"></script>
  <script>
    let candidateData = {};

    async function startInterview() {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const token = document.getElementById('token').value.trim();
      const slot = document.getElementById('slot').value;

      if (!name || !email || !phone || !token || !slot) {
        alert("Please fill in all fields and choose a slot.");
        return;
      }

      const tokenList = await fetch('tokens.json').then(res => res.json());
      if (!tokenList[token]) {
        alert("Invalid or expired token.");
        return;
      }

      // Save data to session
      sessionStorage.setItem('candidate', JSON.stringify({ name, email, phone, slot }));

      // Mark token as used in localStorage (or later via Firebase/GitHub)
      tokenList[token] = false;
      document.getElementById("formSection").style.display = "none";
      document.getElementById("instructions").style.display = "block";
    }

    function beginCountdown() {
      document.getElementById("instructions").style.display = "none";
      document.getElementById("countdown").style.display = "block";
      let counter = 3;
      const interval = setInterval(() => {
        counter--;
        document.getElementById("cdTimer").textContent = counter;
        if (counter === 0) {
          clearInterval(interval);
          window.location.href = "interview.html";
        }
      }, 1000);
    }
  </script>
</body>
</html>
